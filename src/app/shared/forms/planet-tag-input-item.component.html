<mat-list-item (click)="tagChange({ tags: [ tag._id || tag.name ].concat(subTagIds(tag.subTags)), deselectSubs: !isSubcollection })" class="cursor-pointer">
  <mat-icon mat-list-icon *ngIf="isSubcollection">subdirectory_arrow_right</mat-icon>
  <p matLine>
    <mat-checkbox (change)="checkboxChange($event, tag._id || tag.name)" [checked]="isInMap(tag._id || tag.name, selected)" [indeterminate]="isInMap(tag._id || tag.name, indeterminate)"></mat-checkbox>
    <span [ngClass]="{ 'mat-body-2': tag.subTags?.length > 0, 'mat-body-1': (tag.subTags || []).length === 0 }">{{tag.name + ' (' + (tag.count || 0) + ')'}}</span>
    <planet-tag-input-toggle-icon *ngIf="tag.subTags?.length > 0" (click)="toggleSubcollection({event:$event,tagId:tag._id,keepOpen:[]})" [isOpen]="subcollectionIsOpen.get(tag._id)"></planet-tag-input-toggle-icon>
    <button mat-stroked-button *ngIf="isUserAdmin" (click)="editTagClick({event:$event,tag:tag})">Edit</button>
    <span matTooltip="You may only delete a collection with no subcollections" [matTooltipDisabled]="tag.subTags?.length === 0">
      <button mat-stroked-button *ngIf="isUserAdmin" [disabled]="tag.subTags?.length > 0" (click)="deleteTag({event:$event,tag:tag})">Delete</button>
    </span>
  </p>
</mat-list-item>
<ng-container *ngIf="subcollectionIsOpen.get(tag._id)">
  <planet-tag-input-item
    *ngFor="let subTag of tag.subTags"
    [tag]="subTag"
    [selected]="selected"
    [indeterminate]="indeterminate"
    [subcollectionIsOpen]="subcollectionIsOpen"
    (onTagChange)="tagChange($event)"
    (onToggleSubcollection)="toggleSubcollection($event)"
    (onEditTag)="editTagClick($event)"
    (onDeleteTag)="deleteTag($event)">
  </planet-tag-input-item>
</ng-container>
